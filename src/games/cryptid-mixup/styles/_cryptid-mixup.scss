@use '../../../scss/abstracts' as *;

.cmx {
  min-height: 100vh;
  min-height: 100dvh;
  padding: 1rem;
  position: relative;
  isolation: isolate;
  z-index: 0;

  background: image-set(
    url('/games/cryptid-mixup/bg/cmx-bg-wide-1920.avif') type('image/avif'),
    url('/games/cryptid-mixup/bg/cmx-bg-wide-1920.webp') type('image/webp'),
    url('/games/cryptid-mixup/bg/cmx-bg-wide-1920.jpg') type('image/jpeg')
  );
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;

  .cmx__main {
    
  }

  &__header {
    margin-bottom: 1rem;
    text-align: center;
  }

  &__title {
    font-size: clamp(1.25rem, 1rem + 2vw, 2rem);
    letter-spacing: .02rem;
    margin-block: 1.4rem;
  }

  &__board {
    display: grid;
    grid-template-columns: repeat(4, clamp(7.8rem, 8vw, 10rem));
    justify-content: center;
    margin: 0 auto;
    gap: clamp(.8rem, 1.6vw, 1.6rem);
    width: max-content;
  }

  &__card {
    position: relative;
    display: block;
    background: transparent;
    width: 100%;
    aspect-ratio: 5/7;
    border: none;
    border-radius: 1.2rem;
    overflow: hidden;
    perspective: 120rem;

    &.faceDown {
      cursor: pointer;
    }

    &.faceUp .cmx__card-inner,
    &.matched .cmx__card-inner {
      transform: rotateY(180deg);
    }

    &.matched .cmx__card-face--front {
      // background: #1c3321;
      // border: 2px solid #2b6b37;
    }

    &-inner {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border-radius: inherit;
      transform-style: preserve-3d;
      transition: transform 360ms cubic-bezier(.2, .7, .2, 1);
      will-change: transform;
      background: transparent;
    }

    &-face {
      position: absolute;
      inset: 0;
      border-radius: inherit;
      padding: 0;
      clip-path: inset(.5px round 1.2rem);
      transform: translateZ(0);
      background: transparent;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;

      picture,
      img {
        display: block;
        width: 100%;
        height: 100%;
        border-radius: inherit;
      }

      img {
        object-fit: cover;
      }

      &--front {
        transform: rotateY(180deg);
        background: transparent;
      }

      &--back {
        position: absolute;
        overflow: hidden;
        background: radial-gradient(120% 100% at 50% 45%, #11182a 0%, #0c1120 65%, #070c18 100%);

        &::before {
          content: "";
          position: absolute;
          inset: 0;
          border-radius: inherit;
          pointer-events: none;

          mix-blend-mode: screen;
          opacity: .65;

          background: 
            repeating-conic-gradient(
              from 0deg,
            rgba(255,255,255,.06) 0 2deg,
            rgba(255,255,255,0)   2deg 6deg
          ),
          /* subtle crosshatch */
          repeating-linear-gradient(
            45deg,
            rgba(255,255,255,.03) 0 3px,
            transparent            3px 7px
          );

          -webkit-mask: radial-gradient(closest-side, transparent calc(100% -   8px), #000 100%);
          mask: radial-gradient(closest-side, transparent calc(100% - 8px), #000 100%);
        }

        &::after {
          content: "Cryptid\A Mix-up";
          white-space: pre;
          position: absolute;
          inset: -8%;
          display: flex;
          justify-content: center;
          align-items: center;
          transform: rotate(-35deg);  /* corner-to-corner */
          transform-origin: center;
          line-height: 1;
          color: rgba(255,255,210, .4);
          letter-spacing: .18em;
          text-transform: uppercase;
          font-weight: 800;
          font-size: 1.8rem;

          text-shadow:
            0 0 1px  rgba(255,255,255,.30),
            0 0 18px rgba(255,240,130,.28),
            0 0 40px rgba(255,240,130,.16);
          pointer-events: none;
          user-select: none;
          mix-blend-mode: screen;
        }
      }
    }
  }

  &__controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin: 1rem auto 0;
    padding: .6rem 1rem;
    background: rgba(10, 15, 28, .55);
    border: 1px solid rgba(255, 255, 255, .08);
    box-shadow: 0 1rem 2rem rgba(0, 0, 0, .25);
    backdrop-filter: blur(.4rem);
    width: max-content;
  }

  &__btn {
    appearance: none;
    border: 1px solid #2a3454;
    border-radius: .8rem;
    padding: .55rem 1rem;
    font-weight: 700;
    color: #e7f0ff;
    background: linear-gradient(#243155, #1b2236);
    transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
    cursor: pointer;

    &:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 6px 14px rgba(0,0,0,.35);
    filter: brightness(1.04);
    }

    &:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 3px 8px rgba(0,0,0,.35);
    }

    &:disabled {
      opacity: .7;
      cursor: not-allowed;
    }
  }

  &__hud {
    display: flex;
    gap: 1rem;
    font-weight: 800;
    letter-spacing: .02rem;
    font-variant-numeric: tabular-nums;
    white-space: nowrap;
  }

  &__moves,
  &__time {
    padding: .35rem .6rem;
    border-radius: .5rem;
    background: rgba(255, 255, 255, .04);
    border: 1px solid rgba(255, 255, 255, .07);
  }

  &__win {
    margin: 0 0 1rem;
    padding: 1rem;
    border: 1px solid #2b6b37;
    background: #15311d;
    border-radius: 1rem;
    font-weight: 700;
  }



  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
}

@media (max-width: 1400px) and (min-width: 900px) {
  .cmx {
    background-image: image-set(
      url("/games/cryptid-mixup/bg/cmx-bg-wide-1280.avif") type("image/avif"),
      url("/games/cryptid-mixup/bg/cmx-bg-wide-1280.webp") type("image/webp"),
      url("/games/cryptid-mixup/bg/cmx-bg-wide-1280.jpg")  type("image/jpeg")
    );
  }
}

@media (min-width: $bp-md) {
  .cmx__card-face--back::after {
    font-size: 1rem;
  }
}

@media (max-width: $bp-sm) {
  .cmx__controls {
    flex-direction: column;
    width: 100%;
    max-width: 20rem;
  }

  .cmx_hud {
    width: 100%;
    justify-content: center;
  }
}

@media (max-width: $bp-md), (max-aspect-ratio: 3/4) {
  .cmx {
     background-image: image-set(
      url("/games/cryptid-mixup/bg/cmx-bg-tall-1080.avif") type("image/avif"),
      url("/games/cryptid-mixup/bg/cmx-bg-tall-1080.webp") type("image/webp"),
      url("/games/cryptid-mixup/bg/cmx-bg-tall-1080.jpg")  type("image/jpeg")
    );
  }
}

@media (min-width: $bp-xxl) and (min-aspect-ratio: 16/10) {
  .cmx__board {
    grid-template-columns: repeat(8, clamp(9rem, 9vw, 16rem));
  }

  .cmx__card-face--back::after {
    font-size: 1.2rem;
  }
}

@media (max-width: $bp-md) {
  .cmx__board {
    grid-template-columns: repeat(2, clamp(10rem, 40vw, 14rem));
  }
}

@media (max-height: $bp-md) {
  .cmx__board {
    grid-template-columns: repeat(4, clamp(5.5rem, 7.5vh, 7.75rem));
  }
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  .cmx__card .cmx__card-inner {
    transition: none;
  }
}